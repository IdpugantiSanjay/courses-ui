<div class="container"
     *ngIf="{ course: store.course$ | async, watchInfo: store.watchInfo$ | async, hasSections: store.hasSections$ | async , sections: store.sections$ | async, hideWatched: store.hideWatched$ | async, entries: store.entries$ | async, canClear: store.canClear$ | async } as vm">
  <div class="breadcrumb" *ngIf="vm.course">
    <div class="breadcrumb__entry">
      <span><a routerLink="/courses">
        <span class="breadcrumb__entry__name">Courses</span>
      </a></span>
      <span>  /  </span>
    </div>
    <div class="breadcrumb__entry breadcrumb__entry-active">
      <span><a routerLink="/courses/{{vm.course!.id}}">
        <span class="breadcrumb__entry__name">{{vm.course!.name}}</span>
      </a></span>
    </div>
  </div>

  <div class="course" *ngIf="vm.course && vm.watchInfo">
    <div class="course__name">
      {{ vm.course.name }}
    </div>
    <div class="course__meta">
      <div class="course__meta__duration">
        <div>
          <svg class="clock-icon" width="18" height="18" viewBox="0 0 16 16" fill="none"
               xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_1_48)">
              <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M7 0C5.61553 0 4.26216 0.410543 3.11101 1.17971C1.95987 1.94888 1.06266 3.04213 0.532846 4.32122C0.00303304 5.6003 -0.13559 7.00776 0.134506 8.36563C0.404603 9.7235 1.07129 10.9708 2.05026 11.9497C3.02922 12.9287 4.2765 13.5954 5.63437 13.8655C6.99224 14.1356 8.3997 13.997 9.67879 13.4672C10.9579 12.9373 12.0511 12.0401 12.8203 10.889C13.5895 9.73785 14 8.38447 14 7C14 5.14348 13.2625 3.36301 11.9497 2.05025C10.637 0.737498 8.85652 0 7 0ZM10.15 8.4H7.006C6.77593 8.39369 6.55702 8.29948 6.39427 8.13673C6.23152 7.97399 6.13731 7.75507 6.131 7.525V3.509C6.131 3.27694 6.22319 3.05438 6.38728 2.89028C6.55138 2.72619 6.77394 2.634 7.006 2.634C7.23807 2.634 7.46063 2.72619 7.62472 2.89028C7.78882 3.05438 7.881 3.27694 7.881 3.509V6.646H10.15C10.3821 6.646 10.6046 6.73819 10.7687 6.90228C10.9328 7.06638 11.025 7.28894 11.025 7.521C11.025 7.75306 10.9328 7.97562 10.7687 8.13972C10.6046 8.30381 10.3821 8.396 10.15 8.396V8.4Z"
              />
            </g>
            <defs>
              <clipPath id="clip0_1_48">
                <rect width="16" height="16" fill="white"/>
              </clipPath>
            </defs>
          </svg>

        </div>
        <span class="course__meta__duration__text">
          <time *ngIf="vm.watchInfo.durationLeft"> {{ vm.watchInfo.durationLeft }} </time>
          <span *ngIf="vm.watchInfo.durationLeft"> left of </span>
          <time> {{ vm.course!.readableDuration }} </time>
          </span>
      </div>
      <div class="course__meta__watchInfo">
        Watched: {{ vm.watchInfo.watchedIdList.length || 0 }} / {{ vm.course.entries?.length || 0 }}
      </div>
      <div class="course__meta__progress">
          <span>
            Progress
          </span>
        <span>
          <progress max="100" [value]="vm.watchInfo.progress">  {{ vm.watchInfo.progress }}% </progress>
          </span>
        <span>
          <span>{{ vm.watchInfo.progress }}%</span>
        </span>
      </div>
    </div>
    <form class="filters">
      <div>
        <label>
        <span>
        Search:
        </span>
          <input type="text" [formControl]="search">
        </label>
      </div>
      <div>
        <button type="button" (click)="store.toggleHideWatched()">
          <span *ngIf="!vm.hideWatched">
            <svg height="18" class="clock-icon" width="18" clip-rule="evenodd" fill-rule="evenodd"
                 stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path
              d="m17.069 6.546 2.684-2.359c.143-.125.32-.187.497-.187.418 0 .75.34.75.75 0 .207-.086.414-.254.562l-16.5 14.501c-.142.126-.319.187-.496.187-.415 0-.75-.334-.75-.75 0-.207.086-.414.253-.562l2.438-2.143c-1.414-1.132-2.627-2.552-3.547-4.028-.096-.159-.144-.338-.144-.517s.049-.358.145-.517c2.111-3.39 5.775-6.483 9.853-6.483 1.815 0 3.536.593 5.071 1.546zm2.318 1.83c.967.943 1.804 2.013 2.475 3.117.092.156.138.332.138.507s-.046.351-.138.507c-2.068 3.403-5.721 6.493-9.864 6.493-1.298 0-2.553-.313-3.73-.849l2.624-2.307c.352.102.724.156 1.108.156 2.208 0 4-1.792 4-4 0-.206-.016-.408-.046-.606zm-4.932.467c-.678-.528-1.53-.843-2.455-.843-2.208 0-4 1.792-4 4 0 .741.202 1.435.553 2.03l1.16-1.019c-.137-.31-.213-.651-.213-1.011 0-1.38 1.12-2.5 2.5-2.5.474 0 .918.132 1.296.362z"
              fill-rule="nonzero"/></svg>
          </span>
          <span *ngIf="!vm.hideWatched">Hide Watched</span>
          <span *ngIf="vm.hideWatched">
            <svg height="18" class="clock-icon" width="18" clip-rule="evenodd" fill-rule="evenodd"
                 stroke-linejoin="round" stroke-miterlimit="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path
              d="m11.998 5c-4.078 0-7.742 3.093-9.853 6.483-.096.159-.145.338-.145.517s.048.358.144.517c2.112 3.39 5.776 6.483 9.854 6.483 4.143 0 7.796-3.09 9.864-6.493.092-.156.138-.332.138-.507s-.046-.351-.138-.507c-2.068-3.403-5.721-6.493-9.864-6.493zm.002 3c2.208 0 4 1.792 4 4s-1.792 4-4 4-4-1.792-4-4 1.792-4 4-4zm0 1.5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5z"
              fill-rule="nonzero"/></svg>
          </span>
          <span *ngIf="vm.hideWatched">Show Watched</span>
        </button>
      </div>
      <div class="filters__clear">
        <button type="reset" (click)="store.clear(); search.setValue('')" [disabled]="!vm.canClear">Clear Filters</button>
      </div>
    </form>
    <div *ngIf="vm.hasSections; else sectionLess">
      <ng-container *ngFor="let section of vm.sections">
        <ng-container *ngIf="store.sectionEntries(section) | async as entries">
          <details  class="course__section" *ngIf="entries.length > 0">
            <summary class="course__section__name">{{ section }}</summary>
            <app-course-entry-list class="course__section__entries"
                                   [entries]="entries"
                                   (notes)="router.navigate(['/courses', vm.course!.id, $event.entryId, 'notes'])"
                                   (toggleWatched)="$event.watched ? store.setWatched($event.entryId) : store.deleteWatched($event.entryId)"></app-course-entry-list>
          </details>
        </ng-container>

      </ng-container>

    </div>


    <ng-template #sectionLess>
      <app-course-entry-list [entries]="vm.entries || []"
                             (notes)="router.navigate(['/courses', vm.course!.id, $event.entryId, 'notes'])"
                             (toggleWatched)="$event.watched ? store.setWatched($event.entryId) : store.deleteWatched($event.entryId)"></app-course-entry-list>
    </ng-template>
  </div>
</div>
